var sa={is_first_launch:!1,launched:!1,_queue:[],mpshow_time:null,sa_reffer:'\u76f4\u63a5\u6253\u5f00',query_share_depth:0,share_distinct_id:'',share_method:'',current_scene:'',inited:!1,para:{name:'sensors',server_url:'',send_timeout:1e3,use_client_time:!1,show_log:!0,allow_amend_share_path:!0,max_string_length:300,datasend_timeout:3e3,source_channel:[],autoTrack:{appLaunch:!0,appShow:!0,appHide:!0},preset_properties:{}},platform:'',status:{referrer:'\u76f4\u63a5\u6253\u5f00'},lib:{version:'0.1.0',name:'lib',method:'code'},source_channel_standard:'utm_source utm_medium utm_campaign utm_content utm_term',latest_source_channel:['$latest_utm_source','$latest_utm_medium','$latest_utm_campaign','$latest_utm_content','$latest_utm_term','$latest_sa_utm'],latest_share_info:['$latest_share_distinct_id','$latest_share_url_path','$latest_share_depth','$latest_share_method'],currentProps:{},properties:{}};const _toString=Object.prototype.toString,_hasOwnProperty=Object.prototype.hasOwnProperty,indexOf=Array.prototype.indexOf,slice=Array.prototype.slice,_isArray=Array.prototype.isArray,forEach=Array.prototype.forEach;function isString(t){return'[object String]'==_toString.call(t)}function isDate(t){return'[object Date]'==_toString.call(t)}function isBoolean(t){return'[object Boolean]'==_toString.call(t)}function isNumber(t){return'[object Number]'==_toString.call(t)&&/[\d\.]+/.test(String(t))}function isJSONString(t){try{JSON.parse(t)}catch(t){return!1}return!0}function isObject(t){return null!==t&&'object'==typeof t}function isArray(t){return _isArray||'[object Array]'===_toString.call(t)}function each(t,e,s){if(null==t)return!1;if(forEach&&t.forEach===forEach)t.forEach(e,s);else if(t.length===+t.length){for(var r=0,a=t.length;r<a;r++)if(r in t&&e.call(s,t[r],r,t)==={})return!1}else for(var i in t)if(_hasOwnProperty.call(t,i)&&e.call(s,t[i],i,t)==={})return!1}function include(t,e){var s=!1;return null==t?s:indexOf&&t.indexOf===indexOf?-1!=t.indexOf(e):(each(t,function(t){if(s||(s=t===e))return{}}),s)}function formatDate(t){function e(t){return t<10?'0'+t:t}return t.getFullYear()+'-'+e(t.getMonth()+1)+'-'+e(t.getDate())+' '+e(t.getHours())+':'+e(t.getMinutes())+':'+e(t.getSeconds())+'.'+e(t.getMilliseconds())}function searchObjDate(t){isObject(t)&&each(t,function(e,s){isObject(e)?searchObjDate(t[s]):isDate(e)&&(t[s]=formatDate(e))})}function utf8Encode(t){var e,s,r,a,i='';for(e=s=0,r=(t=(t+'').replace(/\r\n/g,'\n').replace(/\r/g,'\n')).length,a=0;a<r;a++){var n=t.charCodeAt(a),o=null;n<128?s++:o=n>127&&n<2048?String.fromCharCode(n>>6|192,63&n|128):String.fromCharCode(n>>12|224,n>>6&63|128,63&n|128),null!==o&&(s>e&&(i+=t.substring(e,s)),i+=o,e=s=a+1)}return s>e&&(i+=t.substring(e,t.length)),i}function base64Encode(t){var e,s,r,a,i,n='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',o=0,c=0,p='',u=[];if(!t)return t;t=utf8Encode(t);do{e=(i=t.charCodeAt(o++)<<16|t.charCodeAt(o++)<<8|t.charCodeAt(o++))>>18&63,s=i>>12&63,r=i>>6&63,a=63&i,u[c++]=n.charAt(e)+n.charAt(s)+n.charAt(r)+n.charAt(a)}while(o<t.length);switch(p=u.join(''),t.length%3){case 1:p=p.slice(0,-2)+'==';break;case 2:p=p.slice(0,-1)+'='}return p}function isFunction(t){try{return/^\s*\bfunction\b/.test(t)}catch(t){return!1}}function extend(t){return each(slice.call(arguments,1),function(e){for(var s in e)void 0!==e[s]&&(t[s]=e[s])}),t}function extend2Lev(t){return each(slice.call(arguments,1),function(e){for(var s in e)void 0!==e[s]&&null!==e[s]&&(isObject(e[s])&&isObject(t[s])?extend(t[s],e[s]):t[s]=e[s])}),t}function isEmptyObject(t){if(isObject(t)){for(var e in t)if(_hasOwnProperty.call(t,e))return!1;return!0}return!1}function formatString(t){return t.length>sa.para.max_string_length?(sa.log('\u5b57\u7b26\u4e32\u957f\u5ea6\u8d85\u8fc7\u9650\u5236\uff0c\u5df2\u7ecf\u505a\u622a\u53d6--'+t),t.slice(0,sa.para.max_string_length)):t}function searchObjString(t){isObject(t)&&each(t,function(e,s){isObject(e)?searchObjString(t[s]):isString(e)&&(t[s]=formatString(e))})}function formatSystem(t){var e=t.toLowerCase();return'ios'===e?'iOS':'android'===e?'Android':t}function getUUID(){return Date.now()+'-'+Math.floor(1e7*Math.random())+'-'+Math.random().toString(16).replace('.','')+'-'+String(31242*Math.random()).replace('.','').slice(0,8)}function stripProperties(t){return isObject(t)?(each(t,function(e,s){if(isArray(e)){var r=[];each(e,function(t){isString(t)?r.push(t):sa.log('\u60a8\u7684\u6570\u636e-',e,'\u7684\u6570\u7ec4\u91cc\u7684\u503c\u5fc5\u987b\u662f\u5b57\u7b26\u4e32,\u5df2\u7ecf\u5c06\u5176\u5220\u9664')}),0!==r.length?t[s]=r:(delete t[s],sa.log('\u5df2\u7ecf\u5220\u9664\u7a7a\u7684\u6570\u7ec4'))}isString(e)||isNumber(e)||isDate(e)||isBoolean(e)||isArray(e)||(sa.log('\u60a8\u7684\u6570\u636e-',e,'-\u683c\u5f0f\u4e0d\u6ee1\u8db3\u8981\u6c42\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u5176\u5220\u9664'),delete t[s])}),t):t}sa.prepareData=function(t,e){var s={distinct_id:sa.store.getDistinctId(),lib:{$lib:sa.lib.name,$lib_method:sa.lib.method,$lib_version:String(sa.lib.version)},properties:{}};s=extend(s,t),isObject(t.properties)&&!isEmptyObject(t.properties)&&(s.properties=extend(s.properties,t.properties)),t.type&&'profile'===t.type.slice(0,7)||(sa.para.batch_send&&(s._track_id=Number(String(Math.random()).slice(2,5)+String(Math.random()).slice(2,4)+String(Date.now()).slice(-4))),s.properties=extend({},sa.properties,sa.currentProps,s.properties),'object'==typeof sa.store._state&&'number'==typeof sa.store._state.first_visit_day_time&&sa.store._state.first_visit_day_time>(new Date).getTime()?s.properties.$is_first_day=!0:s.properties.$is_first_day=!1),s.properties.$time&&isDate(s.properties.$time)?(s.time=1*s.properties.$time,delete s.properties.$time):sa.para.use_client_time&&(s.time=1*new Date),stripProperties(s.properties),searchObjDate(s),searchObjString(s),sa.log(s),sa.send(s)},sa.send=function(t){var e='';t._nocache=(String(Math.random())+String(Math.random())+String(Math.random())).slice(2,15),t=JSON.stringify(t),e=-1!==sa.para.server_url.indexOf('?')?sa.para.server_url+'&data='+encodeURIComponent(base64Encode(t)):sa.para.server_url+'?data='+encodeURIComponent(base64Encode(t)),sa.system_api.request({url:e,dataType:'text',method:'GET',timeout:sa.para.datasend_timeout})},sa.log=function(){if(sa.para.show_log&&'object'==typeof console&&console.log)try{var t=Array.prototype.slice.call(arguments);return console.log.apply(console,t)}catch(t){console.log(arguments[0])}},sa.track=function(t,e,s){sa.prepareData({type:'track',event:t,properties:e},s)},sa.setProfile=function(t){sa.prepareData({type:'profile_set',properties:t})},sa.setOnceProfile=function(t,e){sa.prepareData({type:'profile_set_once',properties:t},e)},sa.login=function(t){var e=sa.store.getFirstId(),s=sa.store.getDistinctId();t!==s&&(e?sa.trackSignup(t,'$SignUp'):(sa.store.set('first_id',s),sa.trackSignup(t,'$SignUp')))},sa.logout=function(t){var e=sa.store.getFirstId();e?(sa.store.set('first_id',''),!0===t?sa.store.set('distinct_id',getUUID()):sa.store.set('distinct_id',e)):sa.log('\u6ca1\u6709first_id\uff0clogout\u5931\u8d25')},sa.identify=function(t){if('number'==typeof t)t=String(t);else if('string'!=typeof t)return!1;sa.store.getFirstId()?sa.store.set('first_id',t):sa.store.set('distinct_id',t)},sa.trackSignup=function(t,e,s){sa.prepareData({original_id:sa.store.getFirstId()||sa.store.getDistinctId(),distinct_id:t,type:'track_signup',event:e,properties:s}),sa.store.set('distinct_id',t)},sa.registerApp=function(t){isObject(t)&&!isEmptyObject(t)&&(sa.currentProps=extend(sa.currentProps,t))},sa.clearAppRegister=function(t){isArray(t)&&each(sa.currentProps,function(e,s){include(t,s)&&delete sa.currentProps[s]})},sa.init=function(t){if(!0===sa.hasExeInit)return!1;this.hasExeInit=!0,sa.setPara(t),sa.store.init(),sa.system.init()},sa.setPara=function(t){sa.para=extend2Lev(sa.para,t);var e=[];if(isArray(sa.para.source_channel))for(var s=sa.para.source_channel.length,r=0;r<s;r++)-1===" utm_source utm_medium utm_campaign utm_content utm_term sa_utm ".indexOf(' '+sa.para.source_channel[r]+' ')&&e.push(sa.para.source_channel[r]);sa.para.source_channel=e,'number'!=typeof sa.para.send_timeout&&(sa.para.send_timeout=1e3),sa.para.server_url?sa.para.preset_properties=isObject(sa.para.preset_properties)?sa.para.preset_properties:{}:sa.log('\u8bf7\u4f7f\u7528 setPara() \u65b9\u6cd5\u8bbe\u7f6e server_url \u6570\u636e\u63a5\u6536\u5730\u5740,\u8be6\u60c5\u53ef\u67e5\u770bhttps://www.sensorsdata.cn/manual/mp_sdk_new.html#112-%E5%BC%95%E5%85%A5%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0')},sa.checkInit=function(){!0===sa.system.inited&&(sa.inited=!0,sa._queue.length>0&&(each(sa._queue,function(t){sa[t[0]].apply(sa,slice.call(t[1]))}),sa._queue=[]))},each(['setProfile','setOnceProfile','track','login','logout'],function(t){var e=sa[t];sa[t]=function(){sa.inited?e.apply(sa,arguments):sa._queue.push([t,arguments])}});var store={storageInfo:null,_state:{},toState:function(t){isObject(t)&&t.distinct_id?this._state=t:this.set('distinct_id',getUUID())},getFirstId:function(){return this._state.first_id},getDistinctId:function(){return this._state.distinct_id},getUnionId:function(){var t={},e=this._state.first_id,s=this._state.distinct_id;return e&&s?(t.login_id=s,t.anonymous_id=e):t.anonymous_id=s,t},getProps:function(){return this._state.props||{}},setProps:function(t,e){var s=this._state.props||{};e?this.set('props',t):(extend(s,t),this.set('props',s))},set:function(t,e){var s={};for(var r in'string'==typeof t?s[t]=e:'object'==typeof t&&(s=t),this._state=this._state||{},s)this._state[r]=s[r];this.save()},save:function(){sa.system_api.setStorageSync(sa.storageName,this._state)},init:function(){var t=sa.system_api.getStorageSync(sa.storageName);if(t)this.toState(t);else{sa.is_first_launch=!0;var e=new Date,s=e.getTime();e.setHours(23),e.setMinutes(59),e.setSeconds(60),sa.setOnceProfile({$first_visit_time:new Date}),this.set({distinct_id:getUUID(),first_visit_time:s,first_visit_day_time:e.getTime()})}}};function request(t){var e=t.url,s=t.dataType,r=t.method,a=t.timeout,i=sa.platform_obj.request({url:e,dataType:s,method:r});setTimeout(function(){isObject(i)&&isFunction(i.abort)&&i.abort()},a)}function getStorage(t,e){try{sa.platform_obj.getStorage({key:t,complete:e})}catch(t){sa.log('\u83b7\u53d6 storage \u5931\u8d25\uff01')}}function getStorageSync(t){var e='';try{e=sa.platform_obj.getStorageSync(t)}catch(s){try{e=sa.platform_obj.getStorageSync(t)}catch(t){sa.log('\u83b7\u53d6 storage \u5931\u8d25\uff01')}}return isJSONString(e)&&(e=JSON.parse(e)),e}function setStorageSync(t,e){var s;try{s=JSON.stringify(e)}catch(t){sa.log('\u5e8f\u5217\u5316\u7f13\u5b58\u5bf9\u8c61\u5931\u8d25\uff01')}var r=function(){sa.platform_obj.setStorageSync(t,s)};try{r()}catch(t){sa.log('set Storage fail --',t);try{r()}catch(t){sa.log('set Storage fail again --',t)}}}sa.store=store;var compose={request:request,getStorage:getStorage,getStorageSync:getStorageSync,setStorageSync:setStorageSync};function getNetwork(){return new Promise(function(t){sa.platform_obj.getNetworkType({success(t){sa.properties.$network_type=t.networkType},fail(t){sa.log('\u83b7\u53d6\u7f51\u7edc\u72b6\u6001\u4fe1\u606f\u5931\u8d25\uff1a ',t)},complete(){t()}})})}function getSystemInfo(){return new Promise((t,e)=>{sa.platform_obj.getSystemInfo({success(t){var e=sa.properties;isObject(t)&&(e.$manufacturer=t.brand,e.$model=t.model,e.$screen_width=Number(t.screenWidth),e.$screen_height=Number(t.screenHeight),e.$os=formatSystem(t.platform),e.$os_version=t.system.indexOf(' ')>-1?t.system.split(' ')[1]:t.system)},fail(t){sa.log('\u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\u5931\u8d25: ',t)},complete(){t()}})})}function getAppId(){var t;if(sa.platform_obj.getAccountInfoSync&&(t=sa.platform_obj.getAccountInfoSync()),isObject(t)&&isObject(t.miniProgram))return t.miniProgram.appId}var system={inited:!1,init:function(){var t=(new Date).getTimezoneOffset();isNumber(t)&&(sa.properties.$timezone_offset=t);var e=getAppId();e?sa.properties.$app_id=e:(sa.para.app_id||sa.para.appid)&&(sa.properties.$app_id=sa.para.app_id);var s=getNetwork(),r=getSystemInfo();Promise.all([s,r]).then(function(){sa.system.inited=!0,sa.checkInit()})}},system$1={inited:!1,init:function(){var t=(new Date).getTimezoneOffset();isNumber(t)&&(sa.properties.$timezone_offset=t);try{sa.properties.$screen_width=Number(window.screen.width),sa.properties.$screen_height=Number(window.screen.height)}catch(t){sa.log('\u83b7\u53d6screen\u5f02\u5e38')}sa.system.inited=!0,sa.checkInit()}},localStorage={get:function(t){return window.localStorage.getItem(t)},parse:function(t){var e;try{e=JSON.parse(this.get(t))||null}catch(t){sa.log(t)}return e},set:function(t,e){window.localStorage.setItem(t,e)},remove:function(t){window.localStorage.removeItem(t)},isSupport:function(){var t=!0;try{var e='__sensorsdatasupport__',s='testIsSupportStorage';this.set(e,s),this.get(e)!==s&&(t=!1),this.remove(e)}catch(e){t=!1}return t}};function getStorageSync$1(t){return localStorage.parse(t)}function setStorageSync$1(t,e){try{JSON.stringify(e)}catch(t){sa.log('\u5e8f\u5217\u5316\u7f13\u5b58\u5bf9\u8c61\u5931\u8d25\uff01')}try{localStorage.set(t,e)}catch(t){sa.log('set Storage fail!')}}var compose$1={request:function(t){if((t=t||{}).timeout=t.timeout||3e4,t.method||t.url)return!1;try{var e=new XMLHttpRequest;e.timeout=t.timeout,e.open(t.method,t.url,!0),e.send(null)}catch(t){sa.log('\u521b\u5efaAJAX\u8bf7\u6c42\u5931\u8d25'+t)}},getStorageSync:getStorageSync$1,setStorageSync:setStorageSync$1};cc.sys.platform===cc.sys.WECHAT_GAME?(sa.lib={version:'0.1.0',name:'MiniGame',method:'code'},sa.system_api=compose,sa.system=system,sa.platform_obj=wx,sa.storageName='sd2015-wechat-game'):cc.sys.platform===cc.sys.QQ_PLAY?(sa.lib={version:'0.1.0',name:'QQMiniGame',method:'code'},sa.system_api=compose,sa.system=system,sa.platform_obj=qq,sa.storageName='sd2015-qq-game'):cc.sys.platform===cc.sys.BYTEDANCE_GAME?(sa.lib={version:'0.1.0',name:'ByteDanceMiniGame',method:'code'},sa.system_api=compose,sa.system=system,sa.platform_obj=tt,sa.storageName='sd2015-bytedance-game'):(sa.lib={version:'0.1.0',name:'H5MiniGame',method:'code'},sa.system_api=compose$1,sa.system=system$1,sa.storageName='sd2015-h5-game');export default sa;