var sa={is_first_launch:!1,launched:!1,_queue:[],mpshow_time:null,sa_referrer:'\u76f4\u63a5\u6253\u5f00',query_share_depth:0,share_distinct_id:'',share_method:'',current_scene:'',inited:!1,para:{server_url:'',send_timeout:1e3,show_log:!1,allow_amend_share_path:!0,max_string_length:500,datasend_timeout:3e3,source_channel:[],batch_send:{send_timeout:6e3,max_length:6},preset_properties:{}},platform:'',lib:{version:'0.12.0',name:'MiniGame',method:'code'},properties:{$lib:'MiniGame',$lib_version:'0.12.0'},currentProps:{}};const _toString=Object.prototype.toString,_hasOwnProperty=Object.prototype.hasOwnProperty,indexOf=Array.prototype.indexOf,slice=Array.prototype.slice,_isArray=Array.prototype.isArray,forEach=Array.prototype.forEach,bind=Function.prototype.bind;function isUndefined(t){return void 0===t}function isString(t){return'[object String]'==_toString.call(t)}function isDate(t){return'[object Date]'==_toString.call(t)}function isBoolean(t){return'[object Boolean]'==_toString.call(t)}function isNumber(t){return'[object Number]'==_toString.call(t)&&/[\d\\.]+/.test(String(t))}function isJSONString(t){try{JSON.parse(t)}catch(t){return!1}return!0}function isObject(t){return null!=t&&'[object Object]'===_toString.call(t)}function isPlainObject(t){return'[object Object]'===_toString.call(t)}function isArray(t){return _isArray||'[object Array]'===_toString.call(t)}function isFuction(t){try{return/^\s*\bfunction\b/.test(t)}catch(t){return!1}}function isArguments(t){return!(!t||!_hasOwnProperty.call(t,'callee'))}function toString(t){return null==t?'':isArray(t)||isPlainObject(t)&&t.toString===_toString?JSON.stringify(t,null,2):String(t)}function each(t,e,i){if(null==t)return!1;if(forEach&&t.forEach===forEach)t.forEach(e,i);else if(t.length===+t.length){for(var s=0,n=t.length;s<n;s++)if(s in t&&e.call(i,t[s],s,t)==={})return!1}else for(var r in t)if(_hasOwnProperty.call(t,r)&&e.call(i,t[r],r,t)==={})return!1}function toArray(t,e){if(!t)return[];var i=[];return t.toArray&&(i=t.toArray()),isArray(t)&&(i=slice.call(t)),isArguments(t)&&(i=slice.call(t)),i=values(t),e&&isNumber(e)&&(i=i.slice(e)),i}function values(t){var e=[];return null==t?e:(each(t,function(t){e[e.length]=t}),e)}function include(t,e){var i=!1;return null==t?i:indexOf&&t.indexOf===indexOf?-1!=t.indexOf(e):(each(t,function(t){if(i||(i=t===e))return{}}),i)}function unique(t){for(var e,i=[],s={},n=0;n<t.length;n++)s[e=t[n]]||(s[e]=!0,i.push(e));return i}function formatDate(t){function e(t){return t<10?'0'+t:t}return t.getFullYear()+'-'+e(t.getMonth()+1)+'-'+e(t.getDate())+' '+e(t.getHours())+':'+e(t.getMinutes())+':'+e(t.getSeconds())+'.'+e(t.getMilliseconds())}function searchObjDate(t){(isObject(t)||isArray(t))&&each(t,function(e,i){isObject(e)||isArray(e)?searchObjDate(t[i]):isDate(e)&&(t[i]=formatDate(e))})}function trim(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,'')}function isFunction(t){if(!t)return!1;var e=Object.prototype.toString.call(t);return'[object Function]'==e||'[object AsyncFunction]'==e||'[object GeneratorFunction]'==e}function extend(t){return each(slice.call(arguments,1),function(e){for(var i in e)void 0!==e[i]&&(t[i]=e[i])}),t}function extend2Lev(t){return each(slice.call(arguments,1),function(e){for(var i in e)void 0!==e[i]&&null!==e[i]&&(isObject(e[i])&&isObject(t[i])?extend(t[i],e[i]):t[i]=e[i])}),t}function isEmptyObject(t){if(isObject(t)){for(var e in t)if(_hasOwnProperty.call(t,e))return!1;return!0}return!1}function deepCopy(t){var e={};return function t(e,i){for(var s in i){var n=i[s];isArray(n)?(e[s]=[],t(e[s],n)):isObject(n)?(e[s]={},t(e[s],n)):e[s]=n}}(e,t),e}function formatString(t){return t.length>sa.para.max_string_length?(sa.log('\u5b57\u7b26\u4e32\u957f\u5ea6\u8d85\u8fc7\u9650\u5236\uff0c\u5df2\u7ecf\u505a\u622a\u53d6--'+t),t.slice(0,sa.para.max_string_length)):t}function searchObjString(t){isObject(t)&&each(t,function(e,i){isObject(e)?searchObjString(t[i]):isString(e)&&(t[i]=formatString(e))})}function encodeDates(t){return each(t,function(e,i){isDate(e)?t[i]=formatDate(e):isObject(e)&&(t[i]=encodeDates(e))}),t}function utf8Encode(t){var e,i,s,n,r='';for(e=i=0,s=(t=(t+'').replace(/\r\n/g,'\n').replace(/\r/g,'\n')).length,n=0;n<s;n++){var a=t.charCodeAt(n),o=null;a<128?i++:o=a>127&&a<2048?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),null!==o&&(i>e&&(r+=t.substring(e,i)),r+=o,e=i=n+1)}return i>e&&(r+=t.substring(e,t.length)),r}function base64Encode(t){var e,i,s,n,r,a='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',o=0,c=0,d='',u=[];if(!t)return t;t=utf8Encode(t);do{e=(r=t.charCodeAt(o++)<<16|t.charCodeAt(o++)<<8|t.charCodeAt(o++))>>18&63,i=r>>12&63,s=r>>6&63,n=63&r,u[c++]=a.charAt(e)+a.charAt(i)+a.charAt(s)+a.charAt(n)}while(o<t.length);switch(d=u.join(''),t.length%3){case 1:d=d.slice(0,-2)+'==';break;case 2:d=d.slice(0,-1)+'='}return d}function _decodeURIComponent(t){var e='';try{e=decodeURIComponent(t)}catch(i){e=t}return e}var SOURCE_CHANNEL_STANDARD='utm_source utm_medium utm_campaign utm_content utm_term',LATEST_SOURCE_CHANNEL=['$latest_utm_source','$latest_utm_medium','$latest_utm_campaign','$latest_utm_content','$latest_utm_term','$latest_sa_utm'],LATEST_SHARE_INFO=['$latest_share_distinct_id','$latest_share_url_path','$latest_share_depth','$latest_share_method'],IDENTITY_KEY={EMAIL:'$identity_email',MOBILE:'$identity_mobile',LOGIN:'$identity_login_id'},IDENTITIES={},RESERVE_CHANNEL=' utm_source utm_medium utm_campaign utm_content utm_term sa_utm ',meta={lib_version:'',launched:!1,lib_name:'',query_share_depth:0,page_show_time:Date.now(),mp_show_time:null,promise_list:[],current_scene:'',is_first_launch:!1,_queue:[],inited:!1,hasExeInit:!1,scene_prefix:'',share_distinct_id:'',sa_referrer:'\u76f4\u63a5\u6253\u5f00',source_channel_standard:SOURCE_CHANNEL_STANDARD,latest_source_channel:LATEST_SOURCE_CHANNEL,latest_share_info:LATEST_SHARE_INFO};function getAppId(){var t=sa.system_api.getAppInfoSync();return t&&t.appId?t.appId:''}function getObjFromQuery(t){var e=t.split('?'),i=[],s={};return e&&e[1]?(each(e[1].split('&'),function(t){(i=t.split('='))[0]&&i[1]&&(s[i[0]]=i[1])}),s):{}}function getMixedQuery(t){var e=detectOptionQuery(t),i=e.scene,s=e.q,n=e.query;for(var r in n)n[r]=_decodeURIComponent(n[r]);return i&&extend(n,getObjFromQuery(i=-1!==(i=_decodeURIComponent(i)).indexOf('?')?'?'+i.replace(/\?/g,''):'?'+i)),s&&extend(n,getObjFromQuery(_decodeURIComponent(s))),n}function detectOptionQuery(t){if(!t||!isObject(t.query))return{};var e,i,s,n,r={};return r.query=extend({},t.query),isString(r.query.scene)&&(e=r.query,i=['utm_source','utm_content','utm_medium','utm_campaign','utm_term','sa_utm'].concat(sa.para.source_channel),s=new RegExp('('+i.join('|')+')%3D','i'),1===(n=Object.keys(e)).length&&'scene'===n[0]&&s.test(e.scene))&&(r.scene=r.query.scene,delete r.query.scene),t.query.q&&t.query.scancode_time&&'101'===String(t.scene).slice(0,3)&&(r.q=String(r.query.q),delete r.query.q,delete r.query.scancode_time),r}function setUtm(t,e){var i={},s=getMixedQuery(t),n=getCustomUtmFromQuery(s,'$','_','$'),r=getCustomUtmFromQuery(s,'$latest_','_latest_','$latest_');return i.pre1=n,i.pre2=r,extend(e,n),i}function setLatestChannel(t){isEmptyObject(t)||(function(t,e){var i=!1;for(var s in e)t[e[s]]&&(i=!0);return i}(t,LATEST_SOURCE_CHANNEL)&&sa.clearAppRegister(LATEST_SOURCE_CHANNEL),sa.registerApp(t))}function getCustomUtmFromQuery(t,e,i,s){if(!isObject(t))return{};var n={};if(t.sa_utm)for(var r in t)'sa_utm'!==r?include(sa.para.source_channel,r)&&(n[i+r]=t[r]):n[s+r]=t[r];else for(var a in t)-1===(' '+SOURCE_CHANNEL_STANDARD+' ').indexOf(' '+a+' ')?include(sa.para.source_channel,a)&&(n[i+a]=t[a]):n[e+a]=t[a];return n}function existLatestUtm(){var t=!1;return each(LATEST_SOURCE_CHANNEL,function(e){sa.properties[e]&&(t=!0)}),t}function setQuery(t,e){if(t&&isObject(t)&&!isEmptyObject(t)){var i=[];return each(t,function(t,s){'q'===s&&isString(t)&&0===t.indexOf('http')||(e?i.push(s+'='+t):i.push(s+'='+_decodeURIComponent(t)))}),i.join('&')}return''}function getCurrentPage(){var t={};try{var e=isFunction(sa.system_api.getCurrentPages)?sa.system_api.getCurrentPages():getCurrentPages();t=e[e.length-1]}catch(t){sa.log('getCurrentPage:'+t)}return t}function getCurrentPath(){var t='\u672a\u53d6\u5230';try{var e=getCurrentPage();t=e?e.route:t}catch(t){sa.log('getCurrentPath:'+t)}return t}function isPresetIdKeys(t,e){var i=['$identity_anonymous_id'];for(var s of(isArray(e)&&(i=i.concat(e)),i))if(s===t)return!0;return!1}var isSafeInteger=Number.isSafeInteger||function(t){return isInteger(t)&&Math.abs(t)<=Math.pow(2,53)-1},isInteger=Number.isInteger||function(t){return'number'==typeof t&&isFinite(t)&&Math.floor(t)===t},check={checkKeyword:function(t){return/^((?!^distinct_id$|^original_id$|^device_id$|^time$|^properties$|^id$|^first_id$|^second_id$|^users$|^events$|^event$|^user_id$|^date$|^datetime$|^user_group|^user_tag)[a-zA-Z_$][a-zA-Z\d_$]{0,99})$/i.test(t)},checkIdLength:function(t){return!(String(t).length>255)||(sa.log('id \u957f\u5ea6\u8d85\u8fc7 255 \u4e2a\u5b57\u7b26\uff01'),!1)}};function getOpenidNameByAppid(t){if(''==t||!isString(t))return sa.log('error: \u53c2\u6570\u5fc5\u987b\u662f\u6709\u6548\u503c'),!1;var e=getAppId(),i="$identity_"+t+"_openid";return e&&(i="$identity_"+t+'_'+e+"_openid"),i}function validId(t){return!isString(t)&&!isNumber(t)||''===t?(sa.log('\u8f93\u5165 ID \u7c7b\u578b\u9519\u8bef'),!1):isNumber(t)&&(t=String(t),!/^\d+$/.test(t))?(sa.log('\u8f93\u5165 ID \u7c7b\u578b\u9519\u8bef'),!1):!!check.checkIdLength(t)&&t}function isNewLoginId(t,e){return t!==sa.store._state.history_login_id.name||sa.store._state.history_login_id.value!==e}function isSameAndAnonymousID(t){var e=sa.store.getFirstId(),i=sa.store.getDistinctId();return e?t===e:t===i}function setUpperCase(t){return isString(t)?t.toLocaleUpperCase():t}function getIsFirstDay(){return!!('object'==typeof sa.store._state&&isNumber(sa.store._state.first_visit_day_time)&&sa.store._state.first_visit_day_time>(new Date).getTime())}function getPresetProperties(){if(sa.properties&&sa.properties.$lib){var t={};each(sa.properties,function(e,i){0===i.indexOf('$')&&(t[i]=e)});var e={$url_path:getCurrentPath(),$is_first_day:getIsFirstDay(),$is_first_time:meta.is_first_launch},i=extend(t,e,sa.properties,sa.store.getProps());return delete i.$lib,i}return{}}function getAnonymousID(){if(!isEmptyObject(sa.store._state))return sa.store._state._first_id||sa.store._state.first_id||sa.store._state._distinct_id||sa.store._state.distinct_id;sa.log('\u8bf7\u5148\u521d\u59cb\u5316SDK')}function joinUrl(t,e){return!!t&&('\u672a\u53d6\u5230'===t?'\u672a\u53d6\u5230':e?t+'?'+e:t)}function getPath(t){return t=isString(t)?t.replace(/^\//,''):'\u53d6\u503c\u5f02\u5e38'}function getAppProps(t){var e={};return t&&t.path&&(e.$url_path=getPath(t.path),e.$url_query=setQuery(t.query),e.$url=joinUrl(e.$url_path,e.$url_query)),e}function getPageProps(){var t=getCurrentPage(),e=getCurrentPath(),i=t.sensors_mp_url_query||'';return{$url_path:e,$url:joinUrl(e,i),$url_query:i}}function rot13defs(t){return rot13obfs(t=String(t),113)}function rot13obfs(t,e){e='number'==typeof e?e:13;for(var i=(t=String(t)).split(''),s=0,n=i.length;s<n;s++){i[s].charCodeAt(0)<126&&(i[s]=String.fromCharCode((i[s].charCodeAt(0)+e)%126))}return i.join('')}var decodeURIComponent$1=_decodeURIComponent;function formatSystem(t){var e=t.toLowerCase();return'ios'===e?'iOS':'android'===e?'Android':t}var getRandomBasic=function(){var t=(new Date).getTime();return function(e){return Math.ceil((t=(9301*t+49297)%233280)/233280*e)}}();function getRandom(){if('function'==typeof Uint32Array){var t='';if('undefined'!=typeof crypto?t=crypto:'undefined'!=typeof msCrypto&&(t=msCrypto),isObject(t)&&t.getRandomValues){var e=new Uint32Array(1);return t.getRandomValues(e)[0]/Math.pow(2,32)}}return getRandomBasic(1e19)/1e19}function getUUID(){return Date.now()+'-'+Math.floor(1e7*getRandom())+'-'+getRandom().toString(16).replace('.','')+'-'+String(31242*getRandom()).replace('.','').slice(0,8)}const _={getUUID:getUUID,formatSystem:formatSystem,indexOf:indexOf,slice:slice,forEach:forEach,bind:bind,_hasOwnProperty:_hasOwnProperty,_toString:_toString,isUndefined:isUndefined,isString:isString,isDate:isDate,isBoolean:isBoolean,isNumber:isNumber,isJSONString:isJSONString,isObject:isObject,isPlainObject:isPlainObject,isArray:isArray,isFuction:isFuction,isArguments:isArguments,toString:toString,unique:unique,include:include,values:values,toArray:toArray,each:each,formatDate:formatDate,searchObjDate:searchObjDate,utf8Encode:utf8Encode,decodeURIComponent:decodeURIComponent$1,encodeDates:encodeDates,base64Encode:base64Encode,trim:trim,isFunction:isFunction,extend:extend,extend2Lev:extend2Lev,isEmptyObject:isEmptyObject,searchObjString:searchObjString,formatString:formatString,setLatestChannel:setLatestChannel,getObjFromQuery:getObjFromQuery,getMixedQuery:getMixedQuery,detectOptionQuery:detectOptionQuery,setUtm:setUtm,getCustomUtmFromQuery:getCustomUtmFromQuery,existLatestUtm:existLatestUtm,setQuery:setQuery,getCurrentPage:getCurrentPage,getCurrentPath:getCurrentPath,rot13defs:rot13defs,rot13obfs:rot13obfs,isSafeInteger:isSafeInteger,isInteger:isInteger,isPresetIdKeys:isPresetIdKeys,deepCopy:deepCopy,check:check,getOpenidNameByAppid:getOpenidNameByAppid,validId:validId,isNewLoginId:isNewLoginId,isSameAndAnonymousID:isSameAndAnonymousID,setUpperCase:setUpperCase,getIsFirstDay:getIsFirstDay,getPageProps:getPageProps,getAppProps:getAppProps,getPath:getPath,joinUrl:joinUrl};function request(t){var e;t.timeout&&(e=t.timeout,delete t.timeout);var i=sa.platform_obj.request(t);setTimeout(function(){try{isObject(i)&&isFunction(i.abort)&&i.abort()}catch(t){sa.log(t)}},e)}function getStorage(t,e){try{sa.platform_obj.getStorage({key:t,success:i,fail:i})}catch(e){try{sa.platform_obj.getStorage({key:t,success:i,fail:i})}catch(t){sa.log('\u83b7\u53d6 storage \u5931\u8d25\uff01',t)}}function i(t){if(t&&t.data&&isJSONString(t.data))try{var i=JSON.parse(t.data);t.data=i}catch(t){sa.log('parse res.data \u5931\u8d25\uff01',t)}e(t)}}function setStorage(t,e){var i;try{i=JSON.stringify(e)}catch(t){sa.log('\u5e8f\u5217\u5316\u7f13\u5b58\u5bf9\u8c61\u5931\u8d25\uff01',t)}try{sa.platform_obj.setStorage({key:t,data:i})}catch(e){try{sa.platform_obj.setStorage({key:t,data:i})}catch(t){sa.log('\u8bbe\u7f6e storage \u5931\u8d25: ',t)}}}function getStorageSync(t){var e='';try{e=sa.platform_obj.getStorageSync(t)}catch(i){try{e=sa.platform_obj.getStorageSync(t)}catch(t){sa.log('\u83b7\u53d6 storage \u5931\u8d25\uff01')}}return isJSONString(e)&&(e=JSON.parse(e)),e}function setStorageSync(t,e){var i;try{i=JSON.stringify(e)}catch(t){sa.log('\u5e8f\u5217\u5316\u7f13\u5b58\u5bf9\u8c61\u5931\u8d25\uff01',t)}var s=function(){sa.platform_obj.setStorageSync(t,i)};try{s()}catch(t){sa.log('set Storage fail --',t);try{s()}catch(t){sa.log('set Storage fail again --',t)}}}function getNetworkType(){return sa.platform_obj.getNetworkType.apply(null,arguments)}function getSystemInfo(){return sa.platform_obj.getSystemInfo.apply(null,arguments)}function getAppId$1(){var t;if(sa.platform_obj.getAccountInfoSync&&(t=sa.platform_obj.getAccountInfoSync()),isObject(t)&&isObject(t.miniProgram))return t.miniProgram}var compose={request:request,getStorage:getStorage,setStorage:setStorage,getStorageSync:getStorageSync,setStorageSync:setStorageSync,getAppInfoSync:getAppId$1,getNetworkType:getNetworkType,getSystemInfo:getSystemInfo};function getNetwork(){return new Promise(function(t){sa.system_api.getNetworkType({success(t){sa.properties.$network_type=setUpperCase(t.networkType)},fail(t){sa.log('\u83b7\u53d6\u7f51\u7edc\u72b6\u6001\u4fe1\u606f\u5931\u8d25\uff1a ',t)},complete(){t()}})})}function getSystemInfo$1(){return new Promise(t=>{sa.system_api.getSystemInfo({success(t){var e=sa.properties;if(isObject(t)){e.$manufacturer=t.brand,e.$model=t.model,e.$brand=setUpperCase(t.brand)||'',e.$screen_width=Number(t.screenWidth),e.$screen_height=Number(t.screenHeight),e.$os=formatSystem(t.platform),e.$os_version=t.system.indexOf(' ')>-1?t.system.split(' ')[1]:t.system,e.$mp_client_app_version=t.version||'';var i=t.SDKVersion||'';i&&(e.$mp_client_basic_library_version=i)}},fail(t){sa.log('\u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\u5931\u8d25: ',t)},complete(){t()}})})}var system={inited:!1,init:function(){var t=(new Date).getTimezoneOffset();isNumber(t)&&(sa.properties.$timezone_offset=t);var e=getAppId()||sa.para.app_id||sa.para.appid;e&&(sa.properties.$app_id=e);var i=getNetwork(),s=getSystemInfo$1();Promise.all([i,s]).then(function(){sa.system.inited=!0,sa.checkInit()})}};IDENTITIES.identity_unionid='$identity_mp_unionid',IDENTITIES.identity_id='$identity_mp_id',IDENTITIES.openid_name='mp',IDENTITIES.bind_preset_id=['$mp_id','$identity_mp_id'],IDENTITIES.unbind_without_check=['$mp_id','$identity_mp_id'],IDENTITIES.login_preset_id=['$mp_openid','$identity_mp_openid','$identity_mp_unionid','$mp_unionid','$mp_id','$identity_mp_id'];var hasOwnProperty$1=Object.prototype.hasOwnProperty,store$1={inited:!0,storageInfo:null,store_queue:[],getStorage:function(){return this.storageInfo?this.storageInfo:(this.storageInfo=sa.system_api.getStorageSync(sa.storageName)||'',this.storageInfo)},_state:{},toState:function(t){var e=null,i=this;function s(){e.distinct_id?i._state=e:i.set('distinct_id',getUUID())}isJSONString(t)?(e=JSON.parse(t),s()):isObject(t)?(e=t,s()):this.set('distinct_id',getUUID());var n=this._state._first_id||this._state.first_id,r=this._state._distinct_id||this._state.distinct_id,a=(this._state.history_login_id?this._state.history_login_id:{}).name;if(this._state.identities&&isString(this._state.identities)){var o=JSON.parse(rot13defs(this._state.identities));this._state.identities=o}function c(t){for(var e in store$1._state.identities)hasOwnProperty$1.call(store$1._state.identities,e)&&e!==IDENTITIES.identity_id&&e!==t&&delete store$1._state.identities[e]}this._state.identities&&isObject(this._state.identities)&&!isEmptyObject(this._state.identities)||(this._state.identities={},this._state.identities[IDENTITIES.identity_id]=getUUID()),n?a&&hasOwnProperty$1.call(this._state.identities,a)?this._state.identities[a]!==r&&(this._state.identities[a]=r,c(a),this._state.history_login_id.value=r):(this._state.identities[IDENTITY_KEY.LOGIN]=r,c(IDENTITY_KEY.LOGIN),this._state.history_login_id={name:IDENTITY_KEY.LOGIN,value:r}):this._state.history_login_id={name:'',value:''},this.save()},getFirstId:function(){return this._state._first_id||this._state.first_id},getDistinctId:function(){var t=this.getLoginDistinctId();return t||(this._state._distinct_id||this._state.distinct_id)},getUnionId:function(){var t={},e=this._state._first_id||this._state.first_id,i=this.getDistinctId();return e&&i?(t.login_id=i,t.anonymous_id=e):t.anonymous_id=i,t},getHistoryLoginId:function(){return isObject(this._state.history_login_id)?this._state.history_login_id:null},getLoginDistinctId:function(){var t=this.getHistoryLoginId();return isObject(t)&&t.value?t.name!==IDENTITY_KEY.LOGIN?t.name+'+'+t.value:t.value:null},getProps:function(){return this._state.props||{}},setProps:function(t,e){var i=this._state.props||{};e?this.set('props',t):(extend(i,t),this.set('props',i))},set:function(t,e){var i={};for(var s in'string'==typeof t?i[t]=e:'object'==typeof t&&(i=t),this._state=this._state||{},i)this._state[s]=i[s],'first_id'===s?delete this._state._first_id:'distinct_id'===s&&(delete this._state._distinct_id,sa.events.emit('changeDistinctId'));this.save()},identitiesSet:function(t){var e={};switch(t.type){case'login':e[IDENTITIES.identity_id]=this._state.identities[IDENTITIES.identity_id],e[t.id_name]=t.id;break;case'logout':e[IDENTITIES.identity_id]=this._state.identities[IDENTITIES.identity_id]}this.set('identities',e)},change:function(t,e){this._state['_'+t]=e},encryptStorage:function(){var t=this.getStorage(),e='data:enc;';isObject(t)?t=e+rot13obfs(JSON.stringify(t)):isString(t)&&-1===t.indexOf(e)&&(t=e+rot13obfs(t)),sa.system_api.setStorageSync(sa.storageName,t)},save:function(){var t=deepCopy(this._state),e=rot13obfs(JSON.stringify(t.identities));if(t.identities=e,delete t._first_id,delete t._distinct_id,sa.para.encrypt_storage){t='data:enc;'+rot13obfs(JSON.stringify(t))}sa.system_api.setStorageSync(sa.storageName,t)},init:function(){var t=this.getStorage(),e=getUUID();if(t)isString(t)&&-1!==t.indexOf("data:enc;")&&(t=t.substring("data:enc;".length),t=JSON.parse(rot13defs(t))),this.toState(t);else{meta.is_first_launch=!0;var i=new Date,s=i.getTime();i.setHours(23),i.setMinutes(59),i.setSeconds(60),this.set({distinct_id:e,first_visit_time:s,first_visit_day_time:i.getTime(),identities:{[IDENTITIES.identity_id]:e},history_login_id:{name:'',value:''}}),sa.setOnceProfile({$first_visit_time:i})}this.checkStoreInit&&this.checkStoreInit()}};function stripProperties(t){return isObject(t)?(each(t,function(e,i){if(isArray(e)){var s=[];each(e,function(t){if(isString(t))s.push(t);else if(isUndefined(t))s.push('null');else try{s.push(JSON.stringify(t))}catch(t){sa.log('\u60a8\u7684\u6570\u636e - '+i+':'+e+' - \u7684\u6570\u7ec4\u91cc\u7684\u503c\u6709\u9519\u8bef,\u5df2\u7ecf\u5c06\u5176\u5220\u9664')}}),t[i]=s}if(isObject(e))try{t[i]=JSON.stringify(e)}catch(s){delete t[i],sa.log('\u60a8\u7684\u6570\u636e - '+i+':'+e+' - \u7684\u6570\u636e\u503c\u6709\u9519\u8bef,\u5df2\u7ecf\u5c06\u5176\u5220\u9664')}else isString(e)||isNumber(e)||isDate(e)||isBoolean(e)||isArray(e)||(sa.log('\u60a8\u7684\u6570\u636e - ',e,'-\u683c\u5f0f\u4e0d\u6ee1\u8db3\u8981\u6c42\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u5176\u5220\u9664'),delete t[i])}),t):t}function parseSuperProperties(t){isObject(t)&&each(t,function(e,i){if(isFunction(e))try{t[i]=e(),isFunction(t[i])&&(sa.log('\u60a8\u7684\u5c5e\u6027 - '+i+' \u683c\u5f0f\u4e0d\u6ee1\u8db3\u8981\u6c42\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u5176\u5220\u9664'),delete t[i])}catch(e){delete t[i],sa.log('\u60a8\u7684\u5c5e\u6027 - '+i+' \u629b\u51fa\u4e86\u5f02\u5e38\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u5176\u5220\u9664')}})}function batchRequest(t){if(isArray(t.data)&&t.data.length>0){var e=Date.now(),i=sa.para.datasend_timeout;t.data.forEach(function(t){t._flush_time=e}),t.data=JSON.stringify(t.data);let s={url:sa.para.server_url,method:'POST',dataType:'text',data:'data_list='+encodeURIComponent(base64Encode(t.data)),timeout:i,success:function(){t.success(t.len)},fail:function(){t.fail()}};sa.system_api.request(s)}else t.success(t.len)}function onceSend(t){t._flush_time=Date.now();var e='',i=JSON.stringify(t);e=-1!==sa.para.server_url.indexOf('?')?sa.para.server_url+'&data='+encodeURIComponent(base64Encode(i)):sa.para.server_url+'?data='+encodeURIComponent(base64Encode(i));var s=sa.para.datasend_timeout;sa.system_api.request({url:e,dataType:'text',method:'GET',timeout:s})}sa.store=store$1;var kit={batchRequest:batchRequest,onceSend:onceSend};function batchSend(){if(sa.batch_state.sended){var t,e,i=sa.batch_state.mem;(e=(t=i.length>=100?i.slice(0,100):i).length)>0&&(sa.batch_state.sended=!1,kit.batchRequest({data:t,len:e,success:batchRemove,fail:sendFail}))}}function sendFail(){sa.batch_state.sended=!0,sa.batch_state.failTime++}function batchRemove(t){sa.batch_state.clear(t),sa.batch_state.sended=!0,sa.batch_state.changed=!0,batchWrite(),sa.batch_state.failTime=0}function batchWrite(){sa.batch_state.changed&&(sa.batch_state.is_first_batch_write&&(sa.batch_state.is_first_batch_write=!1,setTimeout(function(){batchSend()},1e3)),sa.batch_state.syncStorage&&(sa.system_api.setStorageSync('sensors_prepare_data',sa.batch_state.mem),sa.batch_state.changed=!1))}function batchInterval(){!function t(){setTimeout(function(){batchWrite(),t()},1e3)}(),function t(){setTimeout(function(){batchSend(),t()},sa.para.batch_send.send_timeout*Math.pow(2,sa.batch_state.failTime))}()}function reportEvent(t){var e='';t._flush_time=Date.now(),e=t.event?"sensors_"+t.event:"sensors_"+t.type,t.dataSource='sensors',sa.log('report_event, name: ',e,'-- key: ',t),__mp_private_api__.reportEvent(e,t)}function identify(t,e){if(t=_.validId(t)){var i=store$1.getFirstId();!0===e?i?store$1.set('first_id',t):store$1.set('distinct_id',t):i?store$1.change('first_id',t):store$1.change('distinct_id',t)}}function trackSignup(t,e,i){var s,n,r,a;_.isObject(t)?(s=t.id,n=t.event_name,r=t.id_name):(s=t,n=e),store$1.set('distinct_id',s),a=r&&r!==IDENTITY_KEY.LOGIN?r+'+'+s:s;var o=store$1.getFirstId()||store$1.getDistinctId();sa.prepareData({original_id:o,distinct_id:a,type:'track_signup',event:n,properties:i})}function bindWithoutCheck(t,e){store$1._state.identities[t]=e,store$1.save(),sa.prepareData({type:'track_id_bind',event:'$BindID'})}function bind$1(t,e){var i='';if(_.isNumber(e)){if(_.isInteger(e)&&!1===_.isSafeInteger(e))return sa.log('Value must be String'),!1;e=String(e)}if(!_.isString(t))return sa.log('Key must be String'),!1;var s=store$1.getHistoryLoginId(),n=s?s.name:'',r=[IDENTITY_KEY.LOGIN,n];return _.isArray(IDENTITIES.bind_preset_id)&&(r=[IDENTITY_KEY.LOGIN,n].concat(IDENTITIES.bind_preset_id)),!_.check.checkKeyword(t)||_.isPresetIdKeys(t,r)?(i='Key ['+t+'] is invalid',sa.log(i),!1):e&&''!==e?_.isString(e)?!!_.check.checkIdLength(e)&&void bindWithoutCheck(t,e):(sa.log('Value must be String'),!1):(sa.log('Value is empty or null'),!1)}function unbindWithoutCheck(t,e){hasOwnProperty.call(store$1._state.identities,t)&&e===store$1._state.identities[t]&&(IDENTITIES.unbind_without_check&&IDENTITIES.unbind_without_check.indexOf(t)<0&&delete store$1._state.identities[t],store$1.save());var i=store$1.getDistinctId(),s=store$1.getFirstId();i===t+'+'+e&&(store$1.set('first_id',''),store$1.set('distinct_id',s),store$1.set('history_login_id',{name:'',value:''}));var n={};n[t]=e,sa.prepareData({type:'track_id_unbind',event:'$UnbindID',unbind_value:n})}function unbind(t,e){var i='';if(_.isNumber(e)){if(_.isInteger(e)&&!1===_.isSafeInteger(e))return sa.log('Value must be String'),!1;e=String(e)}return _.isString(t)?!_.check.checkKeyword(t)||_.isPresetIdKeys(t,[IDENTITY_KEY.LOGIN])?(i='Key ['+t+'] is invalid',sa.log(i),!1):e&&''!==e?_.isString(e)?!!_.check.checkIdLength(e)&&void unbindWithoutCheck(t,e):(sa.log('Value must be String'),!1):(sa.log('Value is empty or null'),!1):(sa.log('Key must be String'),!1)}function loginWithKey(t,e){if(!_.isString(t))return sa.log('Key must be String'),!1;var i='';if(!_.check.checkKeyword(t)&&t.length>100)i='Key ['+t+'] is invalid',sa.log(i);else if(!_.check.checkKeyword(t))return i='Key ['+t+'] is invalid',sa.log(i),!1;if(_.isPresetIdKeys(t,IDENTITIES.login_preset_id))return i='Key ['+t+'] is invalid',sa.log(i),!1;if(!(e=_.validId(e)))return!1;if(_.isSameAndAnonymousID(e))return!1;var s=store$1.getFirstId(),n=store$1.getDistinctId();_.isNewLoginId(t,e)&&(store$1._state.identities[t]=e,store$1.set('history_login_id',{name:t,value:e}),s||store$1.set('first_id',n),sa.trackSignup({id:e,event_name:'$SignUp',id_name:t}),store$1.identitiesSet({type:'login',id:e,id_name:t}))}function login(t){if(!(t=_.validId(t)))return!1;if(_.isSameAndAnonymousID(t))return!1;var e=store$1.getFirstId(),i=store$1.getDistinctId(),s=IDENTITY_KEY.LOGIN;_.isNewLoginId(s,t)&&(store$1._state.identities&&(store$1._state.identities[s]=t),store$1.set('history_login_id',{name:s,value:t}),e||store$1.set('first_id',i),sa.trackSignup({id:t,event_name:'$SignUp'}),store$1.identitiesSet({type:'login',id:t,id_name:s}))}function logout(){var t=store$1.getFirstId();store$1.identitiesSet({type:'logout'}),store$1.set('history_login_id',{name:'',value:''}),t?(store$1.set('first_id',''),store$1.set('distinct_id',t)):sa.log('\u6ca1\u6709first_id\uff0clogout\u5931\u8d25')}function bindOpenid(t){if(!(t=_.validId(t)))return!1;bind$1(_.getOpenidNameByAppid(IDENTITIES.openid_name),t)}function unbindOpenid(t){if(!_.validId(t))return!1;unbind(_.getOpenidNameByAppid(IDENTITIES.openid_name),t)}sa.batch_state={mem:[],changed:!1,sended:!0,is_first_batch_write:!0,sync_storage:!1,failTime:0,getLength:function(){return this.mem.length},add:function(t){this.mem.push(t)},clear:function(t){this.mem.splice(0,t)}},sa.batchWrite=batchWrite,sa.prepareData=function(t){var e={distinct_id:sa.store.getDistinctId(),lib:{$lib:sa.lib.name,$lib_method:sa.lib.method,$lib_version:String(sa.lib.version)},properties:{}};if(isObject(sa.store._state.identities)&&(e.identities=sa.store._state.identities),'track_id_unbind'===t.type&&'$UnbindID'===t.event&&(e.identities=deepCopy(t.unbind_value),delete t.unbind_value),e=extend(e,sa.store.getUnionId(),t),isObject(t.properties)&&!isEmptyObject(t.properties)&&(e.properties=extend(e.properties,t.properties)),t.type&&'profile'===t.type.slice(0,7)||(e._track_id=Number(String(getRandom()).slice(2,5)+String(getRandom()).slice(2,4)+String(Date.now()).slice(-4)),e.properties=extend({},sa.properties,sa.store.getProps(),sa.currentProps,e.properties),'track'===t.type&&(e.properties.$is_first_day=getIsFirstDay())),e.properties.$time&&isDate(e.properties.$time)?(e.time=1*e.properties.$time,delete e.properties.$time):e.time=1*new Date,sa.ee.data.emit('beforeBuildCheck',e),parseSuperProperties(e.properties),searchObjDate(e),stripProperties(e.properties),searchObjString(e),sa.ee.data.emit('finalAdjustData',e),!sa.para.server_url)return!1;sa.log(e),sa.send(e)},sa.send=function(t){if(t._nocache=(String(getRandom())+String(getRandom())+String(getRandom())).slice(2,15),'sensorsdata2015_binance'===sa.storageName&&'native'===sa.para.data_report_type)return reportEvent(t),!1;sa.para.batch_send?(sa.batch_state.getLength()>=500&&(sa.log('\u6570\u636e\u91cf\u5b58\u50a8\u8fc7\u5927\uff0c\u6709\u5f02\u5e38'),sa.batch_state.mem.shift()),sa.batch_state.add(t),sa.batch_state.changed=!0,sa.batch_state.getLength()>=sa.para.batch_send.max_length&&batchSend()):kit.onceSend(t)},sa.log=function(){if(sa.para.show_log&&'object'==typeof console&&console.log)try{var t=Array.prototype.slice.call(arguments);return console.log.apply(console,t)}catch(t){console.log(arguments[0])}},sa.track=function(t,e,i){sa.prepareData({type:'track',event:t,properties:e},i)},sa.setProfile=function(t){sa.prepareData({type:'profile_set',properties:t})},sa.setOnceProfile=function(t,e){sa.prepareData({type:'profile_set_once',properties:t},e)},sa.login=function(t){var e=sa.store.getFirstId(),i=sa.store.getDistinctId();t!==i&&(e?sa.trackSignup(t,'$SignUp'):(sa.store.set('first_id',i),sa.trackSignup(t,'$SignUp')))},sa.logout=function(t){var e=sa.store.getFirstId();e?(sa.store.set('first_id',''),!0===t?sa.store.set('distinct_id',getUUID()):sa.store.set('distinct_id',e)):sa.log('\u6ca1\u6709first_id\uff0clogout\u5931\u8d25')},sa.identify=function(t){if('number'==typeof t)t=String(t);else if('string'!=typeof t)return!1;sa.store.getFirstId()?sa.store.set('first_id',t):sa.store.set('distinct_id',t)},sa.trackSignup=function(t,e,i){var s,n,r,a,o;isObject(t)?(s=t.id,n=t.event_name,r=t.id_name):(s=t,n=e),sa.store.set('distinct_id',s),a=r&&r!==IDENTITY_KEY.LOGIN?r+'+'+s:s,o=sa.store.getFirstId()||sa.store.getDistinctId(),sa.prepareData({original_id:o,distinct_id:a,type:'track_signup',event:n,properties:i})},sa.registerApp=function(t){isObject(t)&&!isEmptyObject(t)&&(sa.currentProps=extend(sa.currentProps,t))},sa.clearAppRegister=function(t){isArray(t)&&each(sa.currentProps,function(e,i){include(t,i)&&delete sa.currentProps[i]})},sa.register=function(t){isObject(t)&&!isEmptyObject(t)&&sa.store.setProps(t)},sa.clearAllRegister=function(){sa.store.setProps({},!0)},sa.use=function(t){const e=toArray(arguments,1);return e.unshift(this),isObject(t)&&isFunction(t.init)&&t.init.apply(t,e),t},sa.usePlugin=sa.use,sa.getServerUrl=function(){return sa.para.server_url},sa.registerPropertyPlugin=function(t){isFunction(t.properties)?!t.isMatchedWithFilter||isFunction(t.isMatchedWithFilter)?sa.ee.data.on('finalAdjustData',function(e){try{isFunction(t.isMatchedWithFilter)?t.isMatchedWithFilter(e)&&t.properties(e):t.properties(e)}catch(t){sa.log('execute registerPropertyPlugin callback error:'+t)}}):sa.log('registerPropertyPlugin arguments error, isMatchedWithFilter must be function'):sa.log('registerPropertyPlugin arguments error, properties must be function')};var functions=Object.freeze({__proto__:null,identify:identify,trackSignup:trackSignup,bindWithoutCheck:bindWithoutCheck,bind:bind$1,unbindWithoutCheck:unbindWithoutCheck,unbind:unbind,loginWithKey:loginWithKey,login:login,logout:logout,bindOpenid:bindOpenid,unbindOpenid:unbindOpenid}),hasOwnProperty$2=Object.prototype.hasOwnProperty;for(var f in functions)sa[f]=functions[f];sa.setUnionid=function(t){var e=_.validId(t);e&&sa.bind(IDENTITIES.identity_unionid,e)},sa.unsetUnionid=function(t){var e=_.validId(t);if(e){if(hasOwnProperty$2.call(store$1._state.identities,IDENTITIES.identity_unionid)&&e===store$1._state.identities[IDENTITIES.identity_unionid]){var i=_.getOpenidNameByAppid(IDENTITIES.openid_name);hasOwnProperty$2.call(store$1._state.identities,i)&&(delete store$1._state.identities[i],delete store$1._state.openid,store$1.save())}sa.unbind(IDENTITIES.identity_unionid,e)}},sa.bindUnionid=sa.setUnionid,sa.unbindUnionid=sa.unsetUnionid,sa.identify=function(t,e){if(!meta.hasExeInit)return store$1.store_queue.push({method:'identify',params:arguments}),!1;if(t=_.validId(t)){var i=store$1.getFirstId();!0===e?i?store$1.set('first_id',t):store$1.set('distinct_id',t):i?store$1.change('first_id',t):store$1.change('distinct_id',t)}},sa.unsetOpenid=function(t){sa.log('\u8be5\u65b9\u6cd5\u5df2\u4e0d\u5efa\u8bae\u4f7f\u7528\uff0c\u5982\u679c\u662f id3 \u7528\u6237\uff0c\u8bf7\u4f7f\u7528 unbindOpenid \u4ee3\u66ff');var e=_.validId(t);if(!e)return!1;var i=store$1._state.openid;i===e&&store$1.set('openid','');var s=_.getOpenidNameByAppid(IDENTITIES.openid_name);if(hasOwnProperty$2.call(store$1._state.identities,s)&&e===store$1._state.identities[s]){delete store$1._state.identities[s];var n=store$1.getFirstId(),r=store$1.getDistinctId(),a=store$1._state&&store$1._state.identities&&store$1._state.identities.$identity_mp_id;n&&n===i&&a&&store$1.change('first_id',a),r&&r===i&&a&&store$1.change('distinct_id',a),store$1.save()}},sa.setOpenid=function(t,e){if(sa.log('\u8be5\u65b9\u6cd5\u5df2\u4e0d\u5efa\u8bae\u4f7f\u7528\uff0c\u5982\u679c\u662f id2 \u7528\u6237\uff0c\u8bf7\u4f7f\u7528 identify \u4ee3\u66ff\uff0c\u5982\u679c\u662f id3 \u7528\u6237\uff0c\u8bf7\u4f7f\u7528 bindOpenid \u4ee3\u66ff'),!(t=_.validId(t)))return!1;if(!meta.hasExeInit)return store$1.store_queue.push({method:'setOpenid',params:arguments}),!1;e&&sa.log('%c \u5f53\u524d\u7248\u672c setOpenid \u63a5\u53e3 \u5df2\u4e0d\u652f\u6301\u4f20\u5165\u7b2c\u4e8c\u4e2a\u53c2\u6570','color:#F39C12;font-size: 14px;'),store$1.set('openid',t),sa.identify(t,!0);var i=_.getOpenidNameByAppid(IDENTITIES.openid_name);store$1._state.identities[i]=t,store$1.save()},sa.getPresetProperties=getPresetProperties,sa.getAnonymousID=getAnonymousID,sa.getIdentities=function(){return _.isEmptyObject(store$1._state)?(sa.log('\u8bf7\u5148\u521d\u59cb\u5316SDK'),null):store$1._state.identities||null};var openid={getRequest:function(t){wx.login({success:function(e){e.code&&sa.para.appid&&sa.para.openid_url?wx.request({url:sa.para.openid_url+'&code='+e.code+'&appid='+sa.para.appid,method:'GET',complete:function(e){_.isObject(e)&&_.isObject(e.data)&&e.data.openid?t(e.data.openid):t()}}):t()}})},getWXStorage:function(){var t=store$1.getStorage();if(t&&_.isObject(t))return t.openid},getOpenid:function(t){if(!sa.para.appid)return t(),!1;var e=this.getWXStorage();e?t(e):this.getRequest(t)}};function isValidListener(t){return'function'==typeof t||!(!t||'object'!=typeof t)&&isValidListener(t.listener)}sa.initWithOpenid=function(t,e){(t=t||{}).appid&&(sa.para.appid=t.appid),openid.getOpenid(function(i){i&&sa.setOpenid(i,t.isCoverLogin),e&&_.isFunction(e)&&e(i),sa.init(t)})},sa.store.toState=function(t){var e=null,i=this;function s(){e.distinct_id?i._state=e:i.set('distinct_id',getUUID())}isJSONString(t)?(e=JSON.parse(t),s()):isObject(t)?(e=t,s()):this.set('distinct_id',getUUID());var n=this._state._first_id||this._state.first_id,r=this._state._distinct_id||this._state.distinct_id,a=this._state.openid,o=(this._state.history_login_id?this._state.history_login_id:{}).name;if(this._state.identities&&isString(this._state.identities)){var c=JSON.parse(rot13defs(this._state.identities));this._state.identities=c}var d,u,_=getOpenidNameByAppid(IDENTITIES.openid_name);if(this._state.identities&&isObject(this._state.identities)&&!isEmptyObject(this._state.identities)){var p=(d=getAppId(),u='$mp_openid',d&&(u='$mp_'+d+'_openid'),u);hasOwnProperty.call(this._state.identities,'$mp_id')&&(this._state.identities.$identity_mp_id=this._state.identities.$mp_id,delete this._state.identities.$mp_id),hasOwnProperty.call(this._state.identities,'$mp_unionid')&&(this._state.identities.$identity_mp_unionid=this._state.identities.$mp_unionid,delete this._state.identities.$mp_unionid),hasOwnProperty.call(this._state.identities,p)&&(this._state.identities[_]=this._state.identities[p],delete this._state.identities[p])}else this._state.identities={},this._state.identities.$identity_mp_id=getUUID();function l(t){for(var e in store._state.identities)hasOwnProperty.call(store._state.identities,e)&&'$identity_mp_id'!==e&&e!==t&&delete store._state.identities[e]}a&&(this._state.identities[_]=a),n?o&&hasOwnProperty.call(this._state.identities,o)?this._state.identities[o]!==r&&(this._state.identities[o]=r,l(o),this._state.history_login_id.value=r):(this._state.identities[IDENTITY_KEY.LOGIN]=r,l(IDENTITY_KEY.LOGIN),this._state.history_login_id={name:IDENTITY_KEY.LOGIN,value:r}):this._state.history_login_id={name:'',value:''},this.save()},sa.store.checkStoreInit=function(){meta.init_status&&(this.store_queue.length>0&&each(this.store_queue,function(t){sa[t.method].apply(sa,slice.call(t.params))}),this.store_queue=[])};class EventEmitterBase{constructor(){this._events={}}on(t,e){if(!t||!e)return!1;if(!isValidListener(e))throw new Error('listener must be a function');this._events[t]=this._events[t]||[];var i='object'==typeof e;return this._events[t].push(i?e:{listener:e,once:!1}),this}prepend(t,e){if(!t||!e)return!1;if(!isValidListener(e))throw new Error('listener must be a function');this._events[t]=this._events[t]||[];var i='object'==typeof e;return this._events[t].unshift(i?e:{listener:e,once:!1}),this}prependOnce(t,e){return this.prepend(t,{listener:e,once:!0})}once(t,e){return this.on(t,{listener:e,once:!0})}off(t,e){var i=this._events[t];if(!i)return!1;if('number'==typeof e)i.splice(e,1);else if('function'==typeof e)for(var s=0,n=i.length;s<n;s++)i[s]&&i[s].listener===e&&i.splice(s,1);return this}emit(t,e){var i=this._events[t];if(!i)return!1;for(var s=0;s<i.length;s++){var n=i[s];n&&(n.listener.call(this,e||{}),n.once&&this.off(t,s))}return this}removeAllListeners(t){t&&this._events[t]?this._events[t]=[]:this._events={}}listeners(t){return t&&'string'==typeof t?this._events[t]:this._events}}class EventEmitterEx extends EventEmitterBase{constructor(){super(),this.cacheEvents=[],this.maxLen=20}replay(t,e){this.on(t,e),this.cacheEvents.length>0&&this.cacheEvents.forEach(function(i){i.type===t&&e.call(null,i.data)})}emit(t,e){super.emit.apply(this,arguments),this.cacheEvents.push({type:t,data:e}),this.cacheEvents.length>this.maxLen&&this.cacheEvents.shift()}}var ee={};ee.sdk=new EventEmitterEx,ee.data=new EventEmitterEx;var eventEmitter=function(){this.sub=[]};eventEmitter.prototype={add:function(t){this.sub.push(t)},emit:function(t,e){this.sub.forEach(function(i){i.on(t,e)})}};var eventSub=function(t){sa.events.add(this),this._events=[],this.handle=t,this.ready=!1};eventSub.prototype={on:function(t,e){if(this.ready){if(isFunction(this.handle))try{this.handle(t,e)}catch(t){sa.log(t)}}else this._events.push({event:t,data:e})},isReady:function(){var t=this;t.ready=!0,t._events.forEach(function(e){if(isFunction(t.handle))try{t.handle(e.event,e.data)}catch(t){sa.log(t)}})}},sa.ee=ee,sa.meta=meta,sa.kit=kit,sa.modules={},sa.eventSub=eventSub,sa.events=new eventEmitter,sa.init=function(t){if(!0===meta.hasExeInit)return!1;t&&isObject(t)&&sa.setPara(t),meta.hasExeInit=!0,t&&isObject(t)&&sa.setPara(t),ee.sdk.emit('afterInitPara'),sa.store.init(),sa.system.init(),sa.para.batch_send&&(sa.system_api.getStorage('sensors_prepare_data',function(t){var e=[];t&&t.data&&isArray(t.data)&&(e=t.data,sa.batch_state.mem=e.concat(sa.batch_state.mem)),sa.batch_state.syncStorage=!0}),batchInterval())},sa.setPara=function(t){sa.para=extend2Lev(sa.para,t);var e=[];if(isArray(sa.para.source_channel))for(var i=sa.para.source_channel.length,s=0;s<i;s++)-1===RESERVE_CHANNEL.indexOf(' '+sa.para.source_channel[s]+' ')&&e.push(sa.para.source_channel[s]);sa.para.source_channel=e,'number'!=typeof sa.para.send_timeout&&(sa.para.send_timeout=1e3);var n={send_timeout:6e3,max_length:6};t&&t.datasend_timeout||sa.para.batch_send&&(sa.para.datasend_timeout=1e4),!0===sa.para.batch_send?sa.para.batch_send=extend({},n):isObject(sa.para.batch_send)&&(sa.para.batch_send=extend({},n,sa.para.batch_send)),sa.para.server_url?sa.para.preset_properties=isObject(sa.para.preset_properties)?sa.para.preset_properties:{}:sa.log('\u8bf7\u4f7f\u7528 setPara() \u65b9\u6cd5\u8bbe\u7f6e server_url \u6570\u636e\u63a5\u6536\u5730\u5740,\u8be6\u60c5\u53ef\u67e5\u770bhttps://www.sensorsdata.cn/manual/mp_sdk_new.html#112-%E5%BC%95%E5%85%A5%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0')},sa.checkInit=function(){!0===sa.system.inited&&!0===sa.store.inited&&(sa.inited=!0,sa._queue.length>0&&(each(sa._queue,function(t){sa[t[0]].apply(sa,slice.call(t[1]))}),sa._queue=[]))},each(['setProfile','setOnceProfile','track','login','logout','identify','registerApp','clearAppRegister'],function(t){var e=sa[t];sa[t]=function(){sa.inited?e.apply(sa,arguments):sa._queue.push([t,arguments])}}),sa.platform_obj=wx,sa._=_,sa.system=system,sa.system_api=compose,sa.lib.name='MiniProgram',sa.properties.$lib='MiniProgram',sa.storageName='sensorsdata2015_wechat';export default sa;