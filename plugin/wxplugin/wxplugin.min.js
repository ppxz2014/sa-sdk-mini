let autoTrack={_sa:null};var sa={para:{preset_events:{defer_track:!1},autotrack_exclude_page:{pageShow:[]},preset_properties:{}},globalTitle:'',page_route_map:[]};sa.page_show_time=Date.now();const forEach=Array.prototype.forEach,slice=Array.prototype.slice,indexOf=Array.prototype.indexOf,_hasOwnProperty=Object.prototype.hasOwnProperty,_isArray=Array.prototype.isArray,_toString=Object.prototype.toString;function extend(e){return each(slice.call(arguments,1),function(t){for(var r in t)void 0!==t[r]&&(e[r]=t[r])}),e}function isArray(e){return _isArray||'[object Array]'===_toString.call(e)}function isObject(e){return null!==e&&'object'==typeof e}function isEmptyObject(e){if(isObject(e)){for(var t in e)if(_hasOwnProperty.call(e,t))return!1;return!0}return!1}function include(e,t){var r=!1;return null==e?r:indexOf&&e.indexOf===indexOf?-1!=e.indexOf(t):(each(e,function(e){if(r||(r=e===t))return{}}),r)}function isString(e){return'[object String]'==_toString.call(e)}function _decodeURIComponent(e){var t='';try{t=decodeURIComponent(e)}catch(r){t=e}return t}function each(e,t,r){if(null==e)return!1;if(forEach&&e.forEach===forEach)e.forEach(t,r);else if(e.length===+e.length){for(var a=0,n=e.length;a<n;a++)if(a in e&&t.call(r,e[a],a,e)==={})return!1}else for(var o in e)if(_hasOwnProperty.call(e,o)&&t.call(r,e[o],o,e)==={})return!1}function deepCopy(e){var t={};return function e(t,r){for(var a in r){var n=r[a];isArray(n)?(t[a]=[],e(t[a],n)):isObject(n)?(t[a]={},e(t[a],n)):t[a]=n}}(t,e),t}var getPageTitle=function(e){if('\u672a\u53d6\u5230'===e||!e)return'';var t='';try{if(__wxConfig){var r=__wxConfig,a=__wxConfig.page||{},n=a[e]||a[e+'.html'],o={},i={};if(r.global&&r.global.window&&r.global.window.navigationBarTitleText&&(o.titleVal=r.global.window.navigationBarTitleText),n&&n.window&&n.window.navigationBarTitleText&&(i.titleVal=n.window.navigationBarTitleText),!i.titleVal&&__wxAppCode__){var u=__wxAppCode__[e+'.json'];u&&u.navigationBarTitleText&&(i.titleVal=u.navigationBarTitleText)}if(each(sa.globalTitle,function(r,a){if(a===e)return t=r}),0===t.length){var c=extend(o,i);t=c.titleVal||''}}}catch(e){autoTrack._sa.log(e)}return t};function getCurrentPage(){var e={};try{var t=getCurrentPages();e=t[t.length-1]}catch(e){autoTrack._sa.log(e)}return e}function getCurrentPath(){var e='\u672a\u53d6\u5230';try{var t=getCurrentPage();e=t?t.route:e}catch(e){autoTrack._sa.log(e)}return e}function getPath(e){return e=_.isString(e)?e.replace(/^\//,''):'\u53d6\u503c\u5f02\u5e38'}function setPageRefData(e,t,r){var a=getRefPage();isObject(e)&&(t?sa.page_route_map.length>0&&t?(r=r?'?'+r:'',e.$referrer=getPath(t)+r,e.$referrer_title=getPageTitle(t)):(e.$referrer='\u76f4\u63a5\u6253\u5f00',e.$referrer_title=''):(e.$referrer=a.route,e.$referrer_title=a.title))}function setRefPage(){var e={route:'\u76f4\u63a5\u6253\u5f00',title:''};try{var t=getCurrentPage();if(t&&t.route){var r=t.sensors_mp_url_query?'?'+t.sensors_mp_url_query:'',a=t.route,n=getPageTitle(a);e.route=a+r,e.title=n,sa.page_route_map.length>=2?(sa.page_route_map.shift(),sa.page_route_map.push(e)):sa.page_route_map.push(e)}}catch(e){autoTrack._sa.log(e)}}function getRefPage(){var e={route:'\u76f4\u63a5\u6253\u5f00',title:''};return sa.page_route_map.length>1&&(e.title=sa.page_route_map[0].title,e.route=sa.page_route_map[0].route),e}function setQuery(e,t){if(e&&isObject(e)&&!isEmptyObject(e)){var r=[];return each(e,function(e,a){'q'===a&&isString(e)&&0===e.indexOf('http')||(t?r.push(a+'='+e):r.push(a+'='+_decodeURIComponent(e)))}),r.join('&')}return''}function getCustomUtmFromQuery(e,t,r,a){if(!isObject(e))return{};var n={};if(e.sa_utm)for(var o in e)'sa_utm'!==o?include(autoTrack._sa.para.source_channel,o)&&(n[r+o]=e[o]):n[a+o]=e[o];else for(var i in e)-1===(' '+autoTrack._sa.meta.source_channel_standard+' ').indexOf(' '+i+' ')?include(autoTrack._sa.para.source_channel,i)&&(n[r+i]=e[i]):n[t+o]=e[i];return n}function getUtmFromPage(){var e={};try{var t=deepCopy(getCurrentPage().options);for(var r in t)t[r]=_decodeURIComponent(t[r]);e=getCustomUtmFromQuery(t,'$','_','$')}catch(e){autoTrack._sa.log(e)}return e}function setPageSfSource(e){try{var t=getCurrentPage(),r=deepCopy(t?t.options:'');for(var a in r)r[a]=_decodeURIComponent(r[a]);!isEmptyObject(r)&&r._sfs&&(e.$sf_source=r._sfs)}catch(e){autoTrack._sa.log(e)}}function pageOnLoad(e){if(e&&isObject(e)){var t=getCurrentPage();t.sensors_mp_url_query=setQuery(e),t.sensors_mp_encode_url_query=setQuery(e,!0)}}function pageOnShow(){sa.page_show_time=Date.now();var e={},t=getCurrentPage(),r=getCurrentPath(),a=getPageTitle(r);setRefPage(),e.$url_path=r,e.$url_query=t.sensors_mp_url_query?t.sensors_mp_url_query:'',setPageRefData(e=extend(e,getUtmFromPage())),setPageSfSource(e),a&&(e.$title=a),r&&(e.$url=r+e.$url_query),autoTrack._sa.para.onshow?autoTrack._sa.para.onshow(sa,r,this):autoTrack._sa.para.autoTrack.pageShow&&autoTrack._sa.track('$MPViewScreen',e)}function getCurrentPath$1(){var e='\u672a\u53d6\u5230',t=getCurrentPage();return t&&t.route&&(e=t.route),e}var MP_HOOKS={data:1,onLoad:1,onShow:1,onReady:1,onPullDownRefresh:1,onReachBottom:1,onShareAppMessage:1,onPageScroll:1,onResize:1,onTabItemTap:1,onHide:1,onUnload:1};function isClick(e){return!!{tap:1,longtap:1,longpress:1}[e]}function getMethods(e){var t=[];for(var r in e)'function'!=typeof e[r]||MP_HOOKS[r]||t.push(r);return t}function clickTrack(e){var t,r={},a={},n=e.currentTarget||{},o=e.target||{};if(isObject(autoTrack._sa.para.framework)&&isObject(autoTrack._sa.para.framework.taro)&&!autoTrack._sa.para.framework.taro.createApp&&o.id&&n.id&&o.id!==n.id)return!1;var i=n.dataset||{};if(t=e.type,r.$element_id=n.id,r.$element_type=i.type,r.$element_content=i.content,r.$element_name=i.name,isObject(e.event_prop)&&(a=e.event_prop),t&&isClick(t)){if(autoTrack._sa.para.preset_events&&autoTrack._sa.para.preset_events.collect_element&&!1===autoTrack._sa.para.preset_events.collect_element(arguments[0]))return!1;if(r.$url_path=getCurrentPath$1(),binanceClickFilter(r))return!1;r=extend(r,a),autoTrack._sa.track('$MPClick',r)}}function binanceClickFilter(e){var t=!1;return e.$element_id.indexOf(e.$url_path)>=0&&(t=!0),t}function clickProxy(e,t){var r=e[t];e[t]=function(){var e=r.apply(this,arguments),t=arguments[0];return isObject(t)&&clickTrack(t),e}}var preset_events={pageShow:!0,mpClick:!0};function mpProxy(e,t,r){var a=r;if(e[t]){var n=e[t];e[t]=function(){a.apply(this,arguments),n.apply(this,arguments)}}else e[t]=function(){a.apply(this,arguments)}}function proxyPage(){var e=Page;Page=function(t){try{t||(t={}),monitorClick(t),monitorHooks(t),e.apply(this,arguments)}catch(t){e.apply(this,arguments)}}}function proxyComponent(){var e=Component;Component=function(t){try{t||(t={}),t.methods||(t.methods={}),monitorClick(t.methods),monitorHooks(t.methods),e.apply(this,arguments)}catch(t){e.apply(this,arguments)}}}function monitorClick(e){var t=[];if(autoTrack._sa.para.autoTrack&&autoTrack._sa.para.autoTrack.mpClick)for(var r=(t=getMethods(e)).length,a=0;a<r;a++)clickProxy(e,t[a])}function monitorHooks(e){mpProxy(e,'onLoad',pageOnLoad),mpProxy(e,'onShow',pageOnShow)}autoTrack.init=function(e,t){autoTrack._sa=e,this.setPresetEvents(e,t)},autoTrack.setPresetEvents=function(e,t){e.para.autoTrack=extend(preset_events,t),proxyPage(),proxyComponent()};export default autoTrack;