let autoTrack={_sa:null};const forEach=Array.prototype.forEach,slice=Array.prototype.slice,_hasOwnProperty=Object.prototype.hasOwnProperty;function extend(a){return each(slice.call(arguments,1),function(t){for(var e in t)void 0!==t[e]&&(a[e]=t[e])}),a}function isObject(a){return null!==a&&'object'==typeof a}function each(a,t,e){if(null==a)return!1;if(forEach&&a.forEach===forEach)a.forEach(t,e);else if(a.length===+a.length){for(var r=0,o=a.length;r<o;r++)if(r in a&&t.call(e,a[r],r,a)==={})return!1}else for(var n in a)if(_hasOwnProperty.call(a,n)&&t.call(e,a[n],n,a)==={})return!1}function getPath(a){return a='string'==typeof a?a.replace(/^\//,''):'\u53d6\u503c\u5f02\u5e38'}function getCurrentPath(){var a='\u672a\u53d6\u5230';try{var t=getCurrentPages();a=t[t.length-1].route}catch(a){autoTrack._sa.log(a)}return a}function appLaunch(a,t){var e={};isObject(t)&&(e=extend(e,t)),a&&a.path&&(e.$url_path=getPath(a.path)),autoTrack._sa.is_first_launch?e.$is_first_time=!0:e.$is_first_time=!1,autoTrack._sa.para.autoTrack.appLaunch&&autoTrack._sa.track('$MPLaunch',e)}function appShow(a,t){var e={};isObject(t)&&(e=extend(e,t)),autoTrack._sa.mpshow_time=(new Date).getTime(),a&&a.path&&(e.$url_path=getPath(a.path)),autoTrack._sa.para.autoTrack.appShow&&autoTrack._sa.track('$MPShow',e)}function appHide(a){var t=(new Date).getTime(),e={};isObject(a)&&(e=extend(e,a)),e.$url_path=getCurrentPath(),autoTrack._sa.mpshow_time&&t-autoTrack._sa.mpshow_time>0&&(t-autoTrack._sa.mpshow_time)/36e5<24&&(e.event_duration=(t-autoTrack._sa.mpshow_time)/1e3),autoTrack._sa.para.autoTrack.appHide&&autoTrack._sa.track('$MPHide',e)}function pageShow(a){var t={},e=getCurrentPath();isObject(a)&&(t=extend(t,a)),t.$url_path=e,t.$referrer=autoTrack._sa.sa_referrer,autoTrack._sa.para.autoTrack.pageShow&&autoTrack._sa.track('$MPViewScreen',t),autoTrack._sa.sa_referrer=e}function pageLoad(a){}const MP_HOOKS={data:1,onLoad:1,onShow:1,onReady:1,onPullDownRefresh:1,onReachBottom:1,onShareAppMessage:1,onPageScroll:1,onResize:1,onTabItemTap:1,onHide:1,onUnload:1};function isClick(a){return!!{tap:1,longtap:1,longpress:1}[a]}function getMethods(a){var t=[];for(var e in a)'function'!=typeof a[e]||MP_HOOKS[e]||t.push(e);return t}function clickProxy(a,t){var e=a[t];a[t]=function(){var a=e.apply(this,arguments),t={},r='';if(isObject(arguments[0])){isObject(arguments[0].event_prop)&&(t=extend(t,arguments[0].event_prop));var o=arguments[0].currentTarget||{},n=arguments[0].target||{};if(isObject(autoTrack._sa.para.framework)&&isObject(autoTrack._sa.para.framework.taro)&&!autoTrack._sa.para.framework.taro.createApp&&n.id&&o.id&&n.id!==o.id)return a;var p=o.dataset||{};r=arguments[0].type,t.$element_id=o.id,t.$element_type=o.tagName||p.type,t.$element_content=p.content,t.$element_name=p.name}return r&&isClick(r)&&(t.$url_path=getCurrentPath(),autoTrack._sa.track('$MPClick',t)),a}}var presetEvents={appLaunch:!0,appShow:!0,appHide:!0,pageShow:!0,mpClick:!0};autoTrack.init=function(a,t){autoTrack._sa=a,a.appLaunch=appLaunch,a.appShow=appShow,a.appHide=appHide,a.pageShow=pageShow,this.setPresetEvents(a,t)},autoTrack.setPresetEvents=function(a,t){a.para.autoTrack=extend(presetEvents,t),a.platform_obj.onAppShow(function(t){if(!a.para.launched){var e=a.platform_obj.getLaunchOptionsSync()||{};a.appLaunch(e),a.para.launched=!0}a.appShow(t)}),a.platform_obj.onAppHide(function(){a.appHide()});var e=Page,r=Component;try{Page=function(t){try{var r;if(a.para.autoTrack&&a.para.autoTrack.mpClick&&(r=getMethods(t)),r)for(var o=0,n=r.length;o<n;o++)clickProxy(t,r[o]);var p=t.onLoad,c=t.onShow;t.onLoad=function(){p&&p.apply(this,arguments),pageLoad.apply(this,arguments)},t.onShow=function(){c&&c.apply(this),pageShow.apply(this)},e.apply(this,arguments)}catch(a){e.apply(this,arguments)}},Component=function(a){try{var t=a.methods.onLoad,e=a.methods.onShow;a.methods.onLoad=function(){t&&t.apply(this,arguments),pageLoad.apply(this,arguments)},a.methods.onShow=function(){e&&e.apply(this),pageShow.apply(this)},r.apply(this,arguments)}catch(a){r.apply(this,arguments)}}}catch(a){Page=function(){e.apply(this,arguments)},Component=function(){r.apply(this,arguments)}}};export default autoTrack;